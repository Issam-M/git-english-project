<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Quiz Anglais - Fran√ßais</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Firebase compat SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-database-compat.js"></script>
</head>
<body class="quiz-page">
    <nav>
        <ul>
            <li><a href="index.html">Accueil</a></li>
            <li><a href="vocabulaire.html">Vocabulaire</a></li>
            <li><a href="quiz.html">Quiz</a></li>
        </ul>
    </nav>

    <h1>üìù Quiz</h1>

    <div class="quiz-container">
        <label for="direction">Traduire :</label>
        <select id="direction">
            <option value="en-fr">Anglais ‚Üí Fran√ßais</option>
            <option value="fr-en">Fran√ßais ‚Üí Anglais</option>
        </select>

        <div id="quizWord" style="font-size: 24px; font-weight: bold; margin-top: 10px;"></div>

        <input type="text" id="userAnswer" placeholder="√âcris la traduction" autocomplete="off" />

        <button id="checkBtn">V√©rifier</button>
        <button id="nextBtn" style="display:none; margin-left:10px;">Mot suivant</button>

        <div id="message" class="message"></div>
    </div>

<script>
  // Config Firebase (m√™me que dans vocabulaire)
  const firebaseConfig = {
    apiKey: "AIzaSyCMUDjFISW_6u0t9GdMLx3lvdC9k7-MDZA",
    authDomain: "english-project-272a8.firebaseapp.com",
    databaseURL: "https://english-project-272a8-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "english-project-272a8",
    storageBucket: "english-project-272a8.appspot.com",
    messagingSenderId: "248230850925",
    appId: "1:248230850925:web:574e9d6a1f4df889991d1c",
    measurementId: "G-09D2ED5K0X"
  };

  // Initialise Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const directionSelect = document.getElementById('direction');
  const quizWordDiv = document.getElementById('quizWord');
  const userAnswerInput = document.getElementById('userAnswer');
  const checkBtn = document.getElementById('checkBtn');
  const nextBtn = document.getElementById('nextBtn');
  const messageDiv = document.getElementById('message');

  let words = [];
  let currentIndex = -1;

  // Charger les mots depuis Firebase une fois au d√©marrage
  db.ref("words").once("value").then(snapshot => {
  const data = snapshot.val();
  words = data
    ? Object.values(data).filter(word => !word.known) // pourg garder seulement ceux non coch√©s
    : [];


    if (words.length === 0) {
      quizWordDiv.textContent = "Ajoute d'abord des mots dans le vocabulaire !";
      checkBtn.style.display = "none";
      nextBtn.style.display = "none";
    } else {
      const firstWord = pickRandomWord();
      if (firstWord) displayWord(firstWord);
    }
  });

  function pickRandomWord() {
    if (words.length === 0) return null;
    let index;
    do {
      index = Math.floor(Math.random() * words.length);
    } while (index === currentIndex && words.length > 1);
    currentIndex = index;
    return words[index];
  }

  function displayWord(word) {
    const direction = directionSelect.value;
    quizWordDiv.textContent = (direction === 'en-fr') ? word.english : word.french;
    userAnswerInput.value = '';
    userAnswerInput.disabled = false;
    checkBtn.style.display = 'inline-block';
    nextBtn.style.display = 'none';
    messageDiv.textContent = '';
    messageDiv.className = 'message';
    userAnswerInput.focus();
  }

  function checkAnswer() {
    const userAnswer = userAnswerInput.value.trim().toLowerCase();
    const direction = directionSelect.value;
    const correctAnswer = (direction === 'en-fr')
      ? words[currentIndex].french.toLowerCase()
      : words[currentIndex].english.toLowerCase();

    if (userAnswer === '') {
      messageDiv.textContent = '√âcris ta r√©ponse avant de v√©rifier.';
      messageDiv.className = 'message wrong';
      return;
    }

    if (userAnswer === correctAnswer) {
      messageDiv.textContent = '‚úÖ Correct ! Bravo !';
      messageDiv.className = 'message correct';
    } else {
      messageDiv.textContent = `‚ùå Faux. La bonne r√©ponse est : "${correctAnswer}"`;
      messageDiv.className = 'message wrong';
    }

    userAnswerInput.disabled = true;
    checkBtn.style.display = 'none';
    nextBtn.style.display = 'inline-block';
  }

  checkBtn.addEventListener('click', checkAnswer);

  nextBtn.addEventListener('click', () => {
    const nextWord = pickRandomWord();
    if (nextWord) displayWord(nextWord);
  });

  directionSelect.addEventListener('change', () => {
    const newWord = pickRandomWord();
    if (newWord) displayWord(newWord);
  });
</script>

</body>
</html>
