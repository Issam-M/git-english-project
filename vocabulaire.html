<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <title>Vocabulaire Anglais</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Firebase compatibilit√© -->
    <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-database-compat.js"></script>
</head>

<body class="vocabulaire-page">
    <nav>
        <ul>
            <li><a href="index.html">Accueil</a></li>
            <li><a href="vocabulaire.html">Vocabulaire</a></li>
            <li><a href="quiz.html">Quiz</a></li>
        </ul>
    </nav>

    <h1>üìö Vocabulaire</h1>
    <input type="text" id="searchInput" placeholder="üîç Rechercher un mot..." style="margin: 20px 0; padding: 8px; width: 60%; font-size: 16px;" />

    <table>
        <thead>
            <tr>
                <th>üîä</th>
                <th>Anglais</th>
                <th>Fran√ßais</th>
                <th>Exemple</th>
                <th>Acquis</th>
                <th class="action-column">Action</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <h2>‚ûï Ajouter un mot</h2>
    <form id="addWordForm">
        <input type="text" id="english" placeholder="Mot en anglais" required />
        <input type="text" id="french" placeholder="Traduction en fran√ßais" required />
        <input type="text" id="example" placeholder="Phrase d'exemple" />
        <button type="submit">Ajouter</button>
        <button type="button" id="cancelEditBtn" style="display: none;">Annuler</button>
    </form>

    <a href="index.html">‚¨ÖÔ∏è Retour √† l'accueil</a>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCMUDjFISW_6u0t9GdMLx3lvdC9k7-MDZA",
            authDomain: "english-project-272a8.firebaseapp.com",
            databaseURL: "https://english-project-272a8-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "english-project-272a8",
            storageBucket: "english-project-272a8.appspot.com",
            messagingSenderId: "248230850925",
            appId: "1:248230850925:web:574e9d6a1f4df889991d1c",
            measurementId: "G-09D2ED5K0X"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const form = document.getElementById('addWordForm');
        const tableBody = document.getElementById('tableBody');

        // Affiche les mots depuis Firebase
        function displayWords() {
            db.ref("words").on("value", snapshot => {
                tableBody.innerHTML = '';
                const data = snapshot.val();
                if (!data) return;

                Object.keys(data).forEach(key => {
                    const word = data[key];
                    const row = document.createElement('tr');
                    row.innerHTML = `
                       <td>
                            <button class="speak-btn" data-word="${word.english}">üîä</button>
                       </td>
                        <td>${word.english}</td>
                        <td>${word.french}</td>
                        <td>${word.example || ''}</td>
                        <td>
                            <input type="checkbox" class="known-checkbox" data-id="${key}" ${word.known ? 'checked' : ''} />
                        </td>
                        <td class="action-column">
                            <div class="action-buttons">
                                <button class="edit-btn" data-id="${key}">Modifier</button>
                                <button class="delete-btn" data-id="${key}">Supprimer</button>
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            });
        }

        document.getElementById('searchInput').addEventListener('input', function () {
            const filter = this.value.toLowerCase();
            const rows = tableBody.getElementsByTagName('tr');

            for (let row of rows) {
                const english = row.cells[1]?.textContent.toLowerCase() || '';
                const french = row.cells[2]?.textContent.toLowerCase() || '';
                const example = row.cells[3]?.textContent.toLowerCase() || '';

                if (english.includes(filter) || french.includes(filter) || example.includes(filter)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        });


        // G√©rer l'ajout ou la modification
        form.addEventListener('submit', e => {
            e.preventDefault();

            const english = document.getElementById('english').value.trim();
            const french = document.getElementById('french').value.trim();
            const example = document.getElementById('example').value.trim();

            if (!english || !french) {
                alert('Les champs anglais et fran√ßais sont obligatoires !');
                return;
            }

            const editId = form.getAttribute('data-edit-id');
            const wordData = { english, french, example, known: false };

            if (editId) {
                db.ref('words/' + editId).update(wordData);
                form.removeAttribute('data-edit-id');
                form.querySelector('button[type="submit"]').textContent = 'Ajouter';
            } else {
                db.ref('words').push(wordData);
            }

            form.reset();
            document.getElementById('cancelEditBtn').style.display = 'none';
        });

        // √âcoute des clics sur les boutons d‚Äôaction
        tableBody.addEventListener('click', e => {
            if (e.target.classList.contains('delete-btn')) {
                const id = e.target.getAttribute('data-id');
                db.ref('words/' + id).remove();
            }

            if (e.target.classList.contains('edit-btn')) {
                const id = e.target.getAttribute('data-id');
                db.ref('words/' + id).once('value', snapshot => {
                    const word = snapshot.val();

                    document.getElementById('english').value = word.english;
                    document.getElementById('french').value = word.french;
                    document.getElementById('example').value = word.example || '';

                    form.setAttribute('data-edit-id', id);
                    form.querySelector('button[type="submit"]').textContent = 'Modifier le mot';
                    document.getElementById('cancelEditBtn').style.display = 'inline-block';
                });
            }

            if (e.target.classList.contains('speak-btn')) {
                const word = e.target.getAttribute('data-word');
                speakWord(word);
            }
        });

        // Coche "acquis"
        tableBody.addEventListener('change', e => {
            if (e.target.classList.contains('known-checkbox')) {
                const id = e.target.getAttribute('data-id');
                const isKnown = e.target.checked;
                db.ref('words/' + id).update({ known: isKnown });
            }
        });

        // Bouton Annuler
        document.getElementById('cancelEditBtn').addEventListener('click', () => {
            form.reset();
            form.removeAttribute('data-edit-id');
            form.querySelector('button[type="submit"]').textContent = 'Ajouter';
            document.getElementById('cancelEditBtn').style.display = 'none';
        });

        // Fonction de prononciation
        function speakWord(word) {
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = 'en-US';
            speechSynthesis.speak(utterance);
        }

        // Charger au d√©marrage
        displayWords();
    </script>

    <script src="script.js"></script>
</body>

</html>